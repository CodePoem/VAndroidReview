# CAS (compare and swap)

## 基本概念

CAS 是 compare and swap 的简写，即比较并交换。它是指一种操作机制，而不是某个具体的类或方法。在 Java 平台上对这种操作进行了包装。

它需要三个参数，分别是内存位置，旧的预期值 和新的值。操作时，先从内存位置读取到旧值，然后和预期旧值比较。如果相等，则将此内存位置的值改为新值，返回 true。如果不相等，说明和其他线程冲突了，则不做任何改变，返回 false。

这种机制在不阻塞其他线程的情况下避免了并发冲突，比独占锁的性能高很多。 CAS 在 Java 的原子类和并发包中有大量使用。

CAS 只是保证了操作的原子性，并不保证变量的可见性，因此变量需要加上 volatile 关键字。

## ABA 问题

但是如果其他线程将 A 修改为 B 再修改回 A。那么 CAS 会认为这个值并没有被改变，从而继续操作。这是和实际情况不符的。

解决方案是加一个版本号。
