# 网络

1.网络七层协议、五层协议和四层协议是啥？

先说一下七层协议，这是一种理想的协议：
物理层：原始比特流传输 （网卡、网线、集线器）
数据链路层：帧传输 （网桥、交换机） ARP、RARP寻址协议
网络层：分组传输 路由选择 IP
传输层：报文传输 负责向两个主机中进程之间的通信提供服务 TCP/UDP
会话层：数据单元传输 建立管理和对话 SSL TLS协议 RPC
表示层：数据单元传输 信息的语法语义和它们的关联，加密解密
应用层：数据传输 直接为用户的应用进程提供服务 Http/FTP/STMP

五层协议相比七层协议，将会话层、表示层、应用层统称应用层。
四层协议相比五层协议，将物理层、数据链路层统称为网络接口层。

2.TCP/UDP区别。

TCP是可靠的、面向连接的协议，有拥塞控制。可靠体现在无差错，不丢失，不重复，且按序到达。
UDP是不可靠、无连接的协议，无拥塞控制。不可靠体现在尽最大努力交付，即不保证可靠交付。

3.TCP三次握手和四次挥手讲一下，为什么要是三次和四次。

三次握手：
A->B SYN=1 seq=x
B->A SYN=1 seq=y ACK=1 ack=x+1
A->B SYN=1 seq=x+1 ACK=1 ack=y+1

三次才能保证全双工通道的建立。
类比打电话时交流前的信号确认：
A：喂，你能听到吗？（A去确认确认了A的发送能力和B的接收能力）
B：我能听到。你能听到吗？（前半句B确认了A的发送能力和B的接收能力，后半句B去确认B的发送能力和A的接收能力）
A：能听到。（听到B前半句A确认了A的发送能力和B的接收能，听到B后半句确认了B的发送能力和A的接收能力，A最后回复，去让B确认B的发送能力和A的接收能力）

四次挥手：
A->B FIN=1 seq=m
B->A ACK=1 ack=m+1 seq=n
B->A FIN=1 seq=j ACK=1 ack=m+1
A->B ACK=1 ack=j+1 seq=m+1
A等待2MSL（2个最大报文时间），用于确保B没收到应答的重试

四次挥手保证数据传输完毕。
类比挂电话时的确认：
A：我这说完了，你还有什么想说的吗？
B：好的。
（B可能还有一些事情想说）
B：我这也说完了。
A：好的，你挂吧。
（A等两呼吸的时间，没收到回复，A也挂了）

4.TCP的流量控制和拥塞控制是什么意思，是怎么实现的。

流量控制：让发送方的发送速率不要太快，要让接收方来得及接收。
实现方式：TCP报文中有一个滑动窗口的数据段。Client返回的ACK都会告知Server当前Client窗口的大小，Server会根据窗口的大小来控制发送数据和向前滑动。

拥塞控制：解决多主机之间共享网络时出现的拥塞问题。
实现方式：
慢开始算法+拥塞避免算法：
慢开始算法是指拥塞窗口大小基数小，但拥塞窗口大小指数增长，到设定的阈值后变为拥塞避免算法。
拥塞避免算法是指拥塞窗口大小线性增长，遇到网络阻塞，减小阈值，重新变为慢开始算法。
快重传+快恢复
快重传算法是指接收方每收到一个失序的报文段后就立即发出重复确认（为的是使发送方及早知道有报文段没有到达对方）而不要等到自己发送数据时才进行捎带确认，且发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段，而不必继续等待设置的重传计时器到期。
快恢复算法是指遇到网络阻塞，减小阈值，但不执行慢开始算法，而是基于阈值的一半开始执行拥塞避免算法。

5.HTTP缓存策略。

强制缓存：当客户端第一次请求数据时，服务端返回了缓存的过期时间（Expires与Cache-Control），没有过期就可以继续使用缓存，否则不使用，无需再向服务端询问。
Expires：Httpq1.0的缓存表示，采用的服务器绝对时间，已弃用。
Cache-Control：
private 客户端可以缓存
public 客户端和代理服务器都可缓存
max-age=xxx 缓存的内容将在 xxx 秒后失效
s-maxage=xxx 同max-age，但只针对代理服务器缓存
no-cache 需要使用对比缓存来验证缓存数据
no-store 所有内容都不会缓存，强制缓存，对比缓存都不会触发

对比缓存：当客户端第一次请求数据时，服务端会将缓存标识（Last-Modified/If-Modified-Since与Etag/If-None-Match）与数据一起返回给客户端，客户端将两者都备份到缓存中 ，再次请求数据时，客户端将上次备份的缓存标识发送给服务端，服务端根据缓存标识进行判断，如果返回304，则表示通知客户端可以继续使用缓存。
Etag/If-None-Match：Etag是服务端返回的当前资源标识码，将Etag添加到Header的If-None-Match。
Last-Modified/If-Modified-Since：Last-Modified服务端返回的资源上次修改的时间，将Last-Modified添加到Header的If-Modified-Since。

6.HTTPS和HTTP的关系。

HTTPS在HTTP上加了一层SSL
1.客户端给出协议版本号、一个客户端生成的随机数（Client random），以及客户端支持的加密方法。
2.服务器确认双方使用的加密方法，并给出数字证书、以及一个服务器生成的随机数（Server random）。
3.客户端确认数字证书有效，然后生成一个新的随机数（Premaster secret），并使用数字证书中的公钥，加密这个随机数，发给服务器。
4.服务器使用自己的私钥，获取客户端丝发来的随机数（即Premaster secret）。
5.客户端和服务器根据约定的加密方法，使用前面的三个随机数，生成"对话密钥"（session key），用来加密接下来的整个对话过程。